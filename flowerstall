#!/usr/bin/env bash

set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
DEFAULT_FILE="index.md"

if [[ "${1-}" == "-h" || "${1-}" == "--help" ]]; then
  cat <<EOF
Usage: $(basename "$0") [file] [--css list] [--port N] [--lr-port N] [--root path] [...]
Starts the flowerstall preview server. The first positional arg is the content file (default: index.md).
Remaining flags are passed through to server.js.
Examples:
  $(basename "$0") sample/sample.md
  $(basename "$0") ../index.md --css custom.css --port 3000 --lr-port 35729
EOF
  exit 0
fi

TARGET_FILE="${1:-$DEFAULT_FILE}"
if [[ $# -gt 0 ]]; then
  shift
fi

exec node "$SCRIPT_DIR/server.js" --file "$TARGET_FILE" "$@"
